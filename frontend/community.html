<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarmWise Community Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script>
        // Set theme on initial load to prevent flashing
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        /* --- CSS VARIABLES & THEME SWITCHING --- */
        :root {
            /* Light Theme (Default) */
            --bg-main: #f6f8fa; --bg-secondary: #ffffff; --bg-tertiary: #f6f8fa;
            --bg-input: #ffffff; --border-color: #d0d7de; --text-primary: #24292f;
            --text-secondary: #586069; --accent-green: #238636; --accent-green-hover: #2ea043;
            --accent-blue: #0969da; --accent-blue-hover: #0c82f2; --danger-red: #d73a49;
            --danger-red-hover: #da3633; --shadow-color: rgba(140, 149, 159, 0.15);
        }

        html.dark {
            /* Dark Theme Overrides */
            --bg-main: #0D1117; --bg-secondary: #161b22; --bg-tertiary: #0D1117;
            --bg-input: #010409; --border-color: #30363d; --text-primary: #c9d1d9;
            --text-secondary: #8b949e; --accent-green: #2ECC71; --accent-green-hover: #38d57a;
            --accent-blue: #388bfd; --accent-blue-hover: #58a6ff; --danger-red: #e74c3c;
            --danger-red-hover: #f16f63; --shadow-color: rgba(0,0,0,0.4);
        }

        /* --- BASE & LAYOUT --- */
        html, body { margin: 0; padding: 0; height: 100%; }
        body { 
            font-family: 'Inter', sans-serif; background-color: var(--bg-main); color: var(--text-primary); 
            font-size: 16px; line-height: 1.5; transition: background-color 0.3s ease, color 0.3s ease; 
        }
        a { text-decoration: none; color: inherit; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        main { overflow-y: auto; height: calc(100vh - 73px); }

        /* --- NAVBAR STYLES --- */
        .navbar { 
            background-color: var(--bg-secondary); padding: 15px 0; border-bottom: 1px solid var(--border-color); 
            position: sticky; top: 0; z-index: 100; transition: background-color 0.3s ease, border-color 0.3s ease;
            position: relative; /* ADDED: For dropdown positioning */
        }
        .navbar-container { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        .logo { font-size: 24px; font-weight: 800; color: var(--accent-green); }
        .nav-menu-desktop { display: none; align-items: center; gap: 30px; }
        @media (min-width: 992px) { .nav-menu-desktop { display: flex; } } /* MODIFIED: Breakpoint adjusted */
        .nav-menu-desktop a { color: var(--text-primary); display: flex; align-items: center; gap: 8px; transition: color 0.3s ease; font-weight: 500; }
        .nav-menu-desktop a:hover { color: var(--accent-green); }
        .nav-actions { display: flex; align-items: center; gap: 15px; }
        .language-dropdown { position: relative; }
        .language-selector { background: none; border: none; color: var(--text-primary); font-size: 15px; cursor: pointer; padding: 5px 10px; border-radius: 6px; display: flex; align-items: center; gap: 5px; }
        .dropdown-content { display: none; position: absolute; background-color: var(--bg-secondary); min-width: 150px; box-shadow: 0 8px 16px var(--shadow-color); z-index: 100; list-style: none; padding: 8px 0; border-radius: 6px; border: 1px solid var(--border-color); right: 0; top: 100%; margin-top: 10px; }
        .dropdown-content.show { display: block; }
        .dropdown-content li a { color: var(--text-primary); padding: 10px 15px; display: block; font-size: 14px; }
        .dropdown-content li a:hover, .language-selector:hover { background-color: var(--border-color); }
        .theme-button { background: none; border: none; color: var(--text-primary); font-size: 18px; cursor: pointer; border-radius: 6px; width: 38px; height: 38px; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s ease; }
        .theme-button:hover { background-color: var(--border-color); }
        #theme-toggle .fa-moon { display: none; }
        html.dark #theme-toggle .fa-sun { display: none; }
        html.dark #theme-toggle .fa-moon { display: inline-block; }

        /* --- MODIFIED: Responsive Mobile Dropdown Menu --- */
        .hamburger-btn { font-size: 20px; background: none; border: none; color: var(--text-primary); cursor: pointer; padding: 5px; }
        @media (min-width: 992px) { .hamburger-btn { display: none; } } /* MODIFIED: Breakpoint adjusted */
        .mobile-nav-dropdown {
            display: none; position: absolute; top: 100%; left: 0; width: 100%;
            background-color: var(--bg-secondary); border-top: 1px solid var(--border-color);
            padding: 10px 0; box-shadow: 0 8px 16px rgba(0,0,0,0.1); z-index: 99;
        }
        .mobile-nav-dropdown.show { display: block; }
        .mobile-nav-dropdown .nav-menu { display: flex; flex-direction: column; align-items: flex-start; gap: 0; padding: 0 20px; }
        .mobile-nav-dropdown .nav-menu a { padding: 15px 0; width: 100%; font-size: 16px; border-bottom: 1px solid var(--border-color); }
        .mobile-nav-dropdown .nav-menu a:last-child { border-bottom: none; }
        html.dark .mobile-nav-dropdown .nav-menu a { border-color: var(--border-color); }
        
        /* --- HERO & CONTENT STYLING --- */
        .hero-gradient { background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1560493676-04071c5f467b?q=80&w=1974'); background-size: cover; background-position: center; color: white; }
        .content-section { padding: 5rem 0; background-color: var(--bg-secondary); }
        .content-container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .card { background-color: var(--bg-tertiary); padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px var(--shadow-color); border: 1px solid var(--border-color); }
        input, select { width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border-color); background-color: var(--bg-input); color: var(--text-primary); border-radius: 6px; }
        .btn { font-weight: 600; padding: 0.75rem 1.5rem; border-radius: 6px; border: none; cursor: pointer; transition: background-color 0.2s ease; }
        .btn-green { background-color: var(--accent-green); color: white; }
        .btn-green:hover { background-color: var(--accent-green-hover); }
        .btn-blue { background-color: var(--accent-blue); color: white; }
        .btn-blue:hover { background-color: var(--accent-blue-hover); }
        .btn-red { background-color: var(--danger-red); color: white; }
        .btn-red:hover { background-color: var(--danger-red-hover); }

        /* --- UTILITIES --- */
        .hidden { display: none; }
    </style>
</head>
<body>
    <header class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="logo" data-lang-key="header_title">FarmWise</a>
            
            <nav class="nav-menu-desktop">
                <a href="index.html" data-lang-key="nav_home"><i class="fa-solid fa-home"></i> Home</a>
                <a href="chatbot.html" data-lang-key="nav_bot"><i class="fa-solid fa-robot"></i> Krishi Sahayi Bot</a>
                <a href="plant.html" data-lang-key="nav_disease"><i class="fa-solid fa-leaf"></i> Crop Disease Diagnosis</a>
                <a href="weather.html" data-lang-key="nav_weather"><i class="fa-solid fa-cloud-sun"></i> Weather Prediction</a>
                <a href="community.html" data-lang-key="nav_community"><i class="fa-solid fa-users"></i> Farmer Community</a>
            </nav>
            
            <div class="nav-actions">
                <div class="language-dropdown">
                    <button class="language-selector">
                        <span id="current-lang-display">English</span> <i class="fa-solid fa-angle-down" style="font-size: 0.75rem; margin-left: 0.5rem;"></i>
                    </button>
                    <ul class="dropdown-content">
                        <li><a href="#" data-lang="en">English</a></li>
                        <li><a href="#" data-lang="ta">தமிழ் (Tamil)</a></li>
                        <li><a href="#" data-lang="ml">മലയാളം (Malayalam)</a></li>
                    </ul>
                </div>
                <button id="theme-toggle" class="theme-button" title="Toggle Theme">
                    <i class="fa-solid fa-sun"></i>
                    <i class="fa-solid fa-moon"></i>
                </button>
                <button id="hamburger-btn" class="hamburger-btn">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>
        </div>
         <div class="mobile-nav-dropdown" id="mobile-nav-dropdown">
            <nav class="nav-menu">
                <a href="index.html" data-lang-key="nav_home"><i class="fa-solid fa-home"></i> Home</a>
                <a href="chatbot.html" data-lang-key="nav_bot"><i class="fa-solid fa-robot"></i> Krishi Sahayi Bot</a>
                <a href="plant.html" data-lang-key="nav_disease"><i class="fa-solid fa-leaf"></i> Crop Disease Diagnosis</a>
                <a href="weather.html" data-lang-key="nav_weather"><i class="fa-solid fa-cloud-sun"></i> Weather Prediction</a>
                <a href="community.html" data-lang-key="nav_community"><i class="fa-solid fa-users"></i> Farmer Community</a>
            </nav>
        </div>
    </header>
    
    <main>
        <section class="hero-gradient">
            <div class="container" style="padding: 6rem 1rem; text-align: center;">
                <h1 style="font-size: 3.5rem; font-weight: 800; line-height: 1.2; margin-bottom: 1rem;" data-lang-key="hero_title">Growing Together, Harvesting Success</h1>
                <p style="font-size: 1.25rem; max-width: 600px; margin: 0 auto 2rem auto;" data-lang-key="hero_subtitle">Join a thriving community of farmers dedicated to modern techniques, sustainable practices, and mutual growth.</p>
                <a href="#features" class="btn btn-green" data-lang-key="hero_button">See Our Features</a>
            </div>
        </section>
        
        <section id="features" class="content-section">
            <div class="content-container">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <h2 style="font-size: 2.5rem; font-weight: 700;" data-lang-key="features_title">Community Features</h2>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem; max-width: 600px; margin-left: auto; margin-right: auto;" data-lang-key="features_subtitle">Live, interactive tools to empower our members.</p>
                </div>

                <div id="community-list-view" class="card">
                    <h3 style="font-size: 1.5rem; font-weight: 600; display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;" data-lang-key="community_list_title"><i class="fa-solid fa-users" style="color: var(--accent-green);"></i>Explore Communities</h3>
                    <div style="margin: 1rem 0;">
                        <input type="search" id="community-search-input" placeholder="Search for communities...">
                    </div>
                    <div id="community-list" style="display: flex; flex-direction: column; gap: 1rem;"></div>
                </div>

                <div id="community-chat-view" class="hidden card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button id="back-to-list-btn" class="theme-button"><i class="fa-solid fa-arrow-left"></i></button>
                            <h3 id="community-chat-title" style="font-size: 1.5rem; font-weight: 600;"></h3>
                        </div>
                        <button id="leave-community-btn" class="btn btn-red"></button>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;" data-lang-key="board_subtitle">Ask questions, share market prices, and post updates for the community.</p>
                    <div id="forum-posts" style="height: 250px; overflow-y: auto; background-color: var(--bg-main); padding: 1rem; border-radius: 6px; border: 1px solid var(--border-color); margin-bottom: 1rem; display: flex; flex-direction: column; gap: 1rem;"></div>
                    <form id="forum-form" style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: center;">
                        <select id="forum-lang-selector" title="Select message language" style="flex-basis: 100px; flex-grow: 0;"></select>
                        <input type="text" id="forum-name" data-lang-key="board_name_placeholder" placeholder="Your Name" style="flex-grow: 1; flex-basis: 150px;" required>
                        <input type="text" id="forum-message" data-lang-key="board_message_placeholder" placeholder="Write a message or crop price..." style="flex-grow: 4; flex-basis: 250px;" required>
                        <button type="submit" class="btn btn-green" style="flex-basis: 50px; flex-grow: 0;"><i class="fa-solid fa-paper-plane"></i></button>
                    </form>
                </div>
                
                <div class="card" style="margin-top: 2rem; text-align: center;">
                    <div style="display: inline-flex; align-items: center; justify-content: center; height: 4rem; width: 4rem; border-radius: 50%; background-color: var(--accent-green); color: white; margin-bottom: 1rem;"><i class="fa-solid fa-newspaper" style="font-size: 1.5rem;"></i></div>
                    <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem;" data-lang-key="notifications_title">Live Notifications</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;" data-lang-key="notifications_subtitle">Get live on-page notifications about important news and community events.</p>
                    <button id="subscribe-button" class="btn btn-green" data-lang-key="notifications_button">Subscribe to Notifications</button>
                </div>
            </div>
        </section>
    </main>

    <div id="notification-toast" style="position: fixed; bottom: 1.25rem; right: 1.25rem; width: 320px; background-color: var(--bg-secondary); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); border-radius: 0.5rem; padding: 1rem; z-index: 50; opacity: 0; transform: translateY(2.5rem); pointer-events: none; transition: opacity 0.5s, transform 0.5s;">
        </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- ADDED: MOBILE DROPDOWN MENU LOGIC ---
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const mobileNavDropdown = document.getElementById('mobile-nav-dropdown');

        hamburgerBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            mobileNavDropdown.classList.toggle('show');
        });

        // --- DUMMY DATA ---
        let dummyCommunities = [ { id: 'veg', name: 'Vegetable Growers', description: 'Discuss tips for growing healthy vegetables.', isJoined: false }, { id: 'paddy', name: 'Paddy Cultivation', description: 'Share insights on paddy farming.', isJoined: true }, { id: 'fruit', name: 'Fruit Farming', description: 'A community for orchard owners.', isJoined: false }, { id: 'organic', name: 'Organic Farming', description: 'Connect with organic farmers.', isJoined: false }, ];
        let dummyForumPosts = { veg: [{ name: 'Sita', message: 'My tomato plants are showing yellow leaves. What should I do?', language: 'en' }], paddy: [{ name: 'Ramesh', message: 'Expecting good yield this season.', language: 'en' }, { name: 'Kumar', message: 'Water levels are stable.', language: 'ta' }], fruit: [{ name: 'Anjali', message: 'Best time to plant mango saplings?', language: 'en' }], organic: [{ name: 'David', message: 'Looking for organic pesticide recipes.', language: 'en' }] };

        // --- TRANSLATIONS ---
        const translations = {
            en: { header_title: "FarmWise", nav_home: "Home", nav_bot: "Krishi Sahayi Bot", nav_disease: "Crop Disease Diagnosis", nav_weather: "Weather Prediction", nav_community: "Farmer Community", hero_title: "Growing Together, Harvesting Success", hero_subtitle: "Join a thriving community of farmers dedicated to modern techniques, sustainable practices, and mutual growth.", hero_button: "See Our Features", features_title: "Community Features", features_subtitle: "Live, interactive tools to empower our members.", board_subtitle: "Ask questions, share market prices, and post updates for the community.", board_name_placeholder: "Your Name", board_message_placeholder: "Write a message or crop price...", notifications_title: "Live Notifications", notifications_subtitle: "Get live on-page notifications about important news and community events.", notifications_button: "Subscribe to Notifications", unsubscribe_button: "Unsubscribe", community_list_title: "Explore Communities", search_placeholder: "Search for communities...", join_button: "Join", joined_button: "Joined", leave_community: "Leave Community" },
            ta: { header_title: "ஃபார்ம்வைஸ்", nav_home: "முகப்பு", nav_bot: "கிருஷி சஹாயி பாட்", nav_disease: "பயிர் நோய் கண்டறிதல்", nav_weather: "வானிலை முன்னறிவிப்பு", nav_community: "உழவர் சமூகம்", hero_title: "இணைந்து வளர்கிறோம், வெற்றியை அறுவடை செய்கிறோம்", hero_subtitle: "நவீன நுட்பங்கள், நிலையான நடைமுறைகள் மற்றும் பரஸ்பர வளர்ச்சிக்காக அர்ப்பணிக்கப்பட்ட விவசாயிகளின் செழிப்பான சமூகத்தில் சேரவும்.", hero_button: "எங்கள் அம்சங்களைக் காண்க", features_title: "சமூக அம்சங்கள்", features_subtitle: "எங்கள் உறுப்பினர்களுக்கு அதிகாரம் அளிக்க நேரடி, ஊடாடும் கருவிகள்.", board_subtitle: "கேள்விகளைக் கேளுங்கள், சந்தை விலைகளைப் பகிர்ந்து கொள்ளுங்கள், மற்றும் சமூகத்திற்கான புதுப்பிப்புகளை இடுங்கள்.", board_name_placeholder: "உங்கள் பெயர்", board_message_placeholder: "ஒரு செய்தி அல்லது பயிர் விலையை எழுதுங்கள்...", notifications_title: "நேரடி அறிவிப்புகள்", notifications_subtitle: "முக்கியமான செய்திகள் மற்றும் சமூக நிகழ்வுகள் பற்றிய நேரடி பக்க அறிவிப்புகளைப் பெறுங்கள்.", notifications_button: "அறிவிப்புகளுக்கு குழுசேரவும்", unsubscribe_button: "சந்தாவை நீக்கு", community_list_title: "சமூகங்களை ஆராயுங்கள்", search_placeholder: "சமூகங்களைத் தேடுங்கள்...", join_button: "சேரவும்", joined_button: "சேர்ந்தது", leave_community: "சமூகத்தை விட்டு வெளியேறு" },
            ml: { header_title: "ഫാംവൈസ്", nav_home: "ഹോം", nav_bot: "കൃഷി സഹായി ബോട്ട്", nav_disease: "വിള രോഗ നിർണയം", nav_weather: "കാലാവസ്ഥാ പ്രവചനം", nav_community: "കർഷക സമൂഹം", hero_title: "ഒരുമിച്ച് വളരുന്നു, വിജയം കൊയ്യുന്നു", hero_subtitle: "ആധുനിക സാങ്കതിക വിദ്യകൾ, സുസ്ഥിരമായ രീതികൾ, പരസ്പര വളർച്ച എന്നിവയ്ക്കായി സമർപ്പിതരായ കർഷകരുടെ തഴച്ചുവളരുന്ന ഒരു സമൂഹത്തിൽ ചേരുക.", hero_button: "ഞങ്ങളുടെ സവിശേഷതകൾ കാണുക", features_title: "കമ്മ്യൂണിറ്റി സവിശേഷതകൾ", features_subtitle: "ഞങ്ങളുടെ അംഗങ്ങളെ ശാക്തീകരിക്കുന്നതിനുള്ള തത്സമയ, സംവേദനാത്മക ഉപകരണങ്ങൾ.", board_subtitle: "ചോദ്യങ്ങൾ ചോദിക്കുക, വിപണി വിലകൾ പങ്കിടുക, സമൂഹത്തിനായി അപ്ഡേറ്റുകൾ പോസ്റ്റുചെയ്യുക.", board_name_placeholder: "നിങ്ങളുടെ പേര്", board_message_placeholder: "ഒരു സന്ദേശമോ വിളയുടെ വിലയോ എഴുതുക...", notifications_title: "തത്സമയ അറിയിപ്പുകൾ", notifications_subtitle: "പ്രധാനപ്പെട്ട വാർത്തകളെയും കമ്മ്യൂണിറ്റി ഇവന്റുകളെയും കുറിച്ചുള്ള തത്സമയ ഓൺ-പേജ് അറിയിപ്പുകൾ നേടുക.", notifications_button: "അറിയിപ്പുകൾ സബ്സ്ക്രൈബ് ചെയ്യുക", unsubscribe_button: "അൺസബ്സ്ക്രൈബ് ചെയ്യുക", community_list_title: "കമ്മ്യൂണിറ്റികൾ പര്യവേക്ഷണം ചെയ്യുക", search_placeholder: "കമ്മ്യൂണിറ്റികൾക്കായി തിരയുക...", join_button: "ചേരുക", joined_button: "ചേർന്നു", leave_community: "കമ്മ്യൂണിറ്റി വിടുക" }
        };

        // --- UI ELEMENT SELECTORS ---
        const communityListView = document.getElementById('community-list-view');
        const communityChatView = document.getElementById('community-chat-view');
        const communityListEl = document.getElementById('community-list');
        const backToListBtn = document.getElementById('back-to-list-btn');
        const chatTitleEl = document.getElementById('community-chat-title');
        const forumPostsEl = document.getElementById('forum-posts');
        const forumForm = document.getElementById('forum-form');
        const searchInput = document.getElementById('community-search-input');
        const leaveCommunityBtn = document.getElementById('leave-community-btn');
        const subscribeBtn = document.getElementById('subscribe-button');
        const toastEl = document.getElementById('notification-toast');

        // ... (The rest of your script remains the same)
        let toastTimeout; let isSubscribed = localStorage.getItem('isSubscribed') === 'true';
        function showNotification(title, message) { clearTimeout(toastTimeout); toastEl.innerHTML = `<div style="font-weight: 600; color: var(--text-primary);">${title}</div><p style="color: var(--text-secondary);">${message}</p>`; toastEl.style.opacity = '1'; toastEl.style.transform = 'translateY(0)'; toastEl.style.pointerEvents = 'auto'; toastTimeout = setTimeout(() => { toastEl.style.opacity = '0'; toastEl.style.transform = 'translateY(2.5rem)'; toastEl.style.pointerEvents = 'none'; }, 5000); }
        function updateSubscriptionButton() { const lang = localStorage.getItem('language') || 'en'; if (isSubscribed) { subscribeBtn.textContent = translations[lang].unsubscribe_button; subscribeBtn.className = 'btn btn-red'; } else { subscribeBtn.textContent = translations[lang].notifications_button; subscribeBtn.className = 'btn btn-green'; } }
        subscribeBtn.addEventListener('click', () => { isSubscribed = !isSubscribed; localStorage.setItem('isSubscribed', isSubscribed); updateSubscriptionButton(); if (isSubscribed) { showNotification('Subscribed!', 'You will now receive live notifications.'); } else { showNotification('Unsubscribed', 'You will no longer receive notifications.'); } });
        function showCommunityChat(community) { const lang = localStorage.getItem('language') || 'en'; chatTitleEl.textContent = community.name; leaveCommunityBtn.textContent = translations[lang].leave_community; leaveCommunityBtn.dataset.communityId = community.id; forumForm.dataset.communityId = community.id; renderForumPosts(community.id); communityListView.classList.add('hidden'); communityChatView.classList.remove('hidden'); }
        function showCommunityList() { communityChatView.classList.add('hidden'); communityListView.classList.remove('hidden'); renderCommunityList(); }
        function renderCommunityList() { const searchTerm = searchInput.value.toLowerCase(); const filteredCommunities = dummyCommunities.filter(c => c.name.toLowerCase().includes(searchTerm)); const lang = localStorage.getItem('language') || 'en'; communityListEl.innerHTML = ''; filteredCommunities.forEach(community => { const div = document.createElement('div'); div.style = 'display: flex; align-items: center; justify-content: space-between; padding: 1rem; background-color: var(--bg-main); border: 1px solid var(--border-color); border-radius: 6px;'; const textContent = `<div><h4 style="font-weight: 600; font-size: 1.1rem; color: var(--text-primary);">${community.name}</h4><p style="font-size: 0.9rem; color: var(--text-secondary);">${community.description}</p></div>`; const joinButton = document.createElement('button'); if (community.isJoined) { joinButton.textContent = translations[lang].joined_button; joinButton.className = 'btn btn-green'; div.style.cursor = 'pointer'; div.addEventListener('click', (e) => { if (e.target !== joinButton) showCommunityChat(community); }); } else { joinButton.textContent = translations[lang].join_button; joinButton.className = 'btn btn-blue'; joinButton.addEventListener('click', (e) => { e.stopPropagation(); community.isJoined = true; showNotification('Success!', `You have joined the ${community.name} community.`); renderCommunityList(); }); } div.innerHTML = textContent; div.appendChild(joinButton); communityListEl.appendChild(div); }); }
        function renderForumPosts(communityId) { const posts = dummyForumPosts[communityId] || []; forumPostsEl.innerHTML = ''; posts.slice().reverse().forEach(post => { const postEl = document.createElement('div'); postEl.style = 'padding: 0.75rem; background-color: var(--bg-secondary); border-radius: 6px;'; const langTag = (post.language || 'en').toUpperCase(); postEl.innerHTML = `<div style="display: flex; justify-content: space-between; align-items: center;"><p style="font-weight: 600; color: var(--accent-green);">${post.name}</p><span style="font-size: 0.75rem; padding: 2px 6px; background-color: var(--border-color); border-radius: 99px;">${langTag}</span></div><p style="color: var(--text-primary); margin-top: 0.25rem; word-break: break-word;">${post.message}</p>`; forumPostsEl.appendChild(postEl); }); forumPostsEl.scrollTop = 0; }
        backToListBtn.addEventListener('click', showCommunityList);
        searchInput.addEventListener('input', renderCommunityList);
        leaveCommunityBtn.addEventListener('click', () => { const communityId = leaveCommunityBtn.dataset.communityId; const community = dummyCommunities.find(c => c.id === communityId); if (community) { community.isJoined = false; showNotification('Success', `You have left the ${community.name} community.`); showCommunityList(); } });
        forumForm.addEventListener('submit', (e) => { e.preventDefault(); const name = document.getElementById('forum-name').value; const message = document.getElementById('forum-message').value; const language = document.getElementById('forum-lang-selector').value; const communityId = forumForm.dataset.communityId; if (!name.trim() || !message.trim() || !communityId) return; dummyForumPosts[communityId].push({ name, message, language }); document.getElementById('forum-message').value = ''; renderForumPosts(communityId); });
        const langSelectorBtn = document.querySelector('.language-selector');
        const langDropdown = document.querySelector('.dropdown-content');
        const langLinks = langDropdown.querySelectorAll('a');
        const currentLangDisplay = document.getElementById('current-lang-display');
        function setLanguage(lang) { localStorage.setItem('language', lang); const langName = lang === 'ta' ? 'தமிழ்' : lang === 'ml' ? 'മലയാളം' : 'English'; currentLangDisplay.textContent = langName; document.querySelectorAll('[data-lang-key]').forEach(el => { const key = el.getAttribute('data-lang-key'); if (translations[lang] && translations[lang][key]) { if (el.placeholder) el.placeholder = translations[lang][key]; else { const icon = el.querySelector('i'); el.innerHTML = (icon ? icon.outerHTML + ' ' : '') + translations[lang][key]; } } }); renderCommunityList(); searchInput.placeholder = translations[lang].search_placeholder; updateSubscriptionButton(); }
        langSelectorBtn.addEventListener('click', (e) => { e.stopPropagation(); langDropdown.classList.toggle('show'); });
        langLinks.forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); setLanguage(e.target.dataset.lang); langDropdown.classList.remove('show'); }); });
        
        // MODIFIED: Window click listener to close both dropdowns
        document.addEventListener('click', (e) => { 
            if (!langSelectorBtn.parentElement.contains(e.target)) {
                langDropdown.classList.remove('show');
            }
            if (!hamburgerBtn.contains(e.target) && !mobileNavDropdown.contains(e.target)) {
                mobileNavDropdown.classList.remove('show');
            }
        });

        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        });
        
        setLanguage(localStorage.getItem('language') || 'en');
        renderCommunityList();
        updateSubscriptionButton();
    });
    </script>
</body>
</html>
